{"ast":null,"code":"var _jsxFileName = \"/home/phamvanhung/Product_test/Chatbot_GL2_version1/FlaskAIChatbot/frontend/src/components/MessageInput.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPaperPlane, faMicrophone, faStop } from '@fortawesome/free-solid-svg-icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MessageInput = ({\n  onSendMessage\n}) => {\n  _s();\n  const [message, setMessage] = useState('');\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioBlob, setAudioBlob] = useState(null);\n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n  const textInputRef = useRef(null);\n  const handleInputChange = e => {\n    setMessage(e.target.value);\n  };\n  const handleSubmit = e => {\n    e.preventDefault();\n    if (message.trim()) {\n      onSendMessage(message);\n      setMessage('');\n    }\n  };\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: true\n      });\n      mediaRecorderRef.current = new MediaRecorder(stream);\n      mediaRecorderRef.current.ondataavailable = event => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n        }\n      };\n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, {\n          type: 'audio/wav'\n        });\n        setAudioBlob(audioBlob);\n        audioChunksRef.current = [];\n\n        // Send audio to backend\n        const reader = new FileReader();\n        reader.readAsDataURL(audioBlob);\n        reader.onloadend = () => {\n          const base64Audio = reader.result.split(',')[1];\n          onSendMessage(base64Audio, true);\n        };\n\n        // Stop all tracks of the stream\n        stream.getTracks().forEach(track => track.stop());\n      };\n      audioChunksRef.current = [];\n      mediaRecorderRef.current.start();\n      setIsRecording(true);\n    } catch (error) {\n      console.error('Error accessing microphone:', error);\n      alert('Không thể truy cập microphone. Vui lòng kiểm tra quyền truy cập.');\n    }\n  };\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n  const handleKeyDown = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e);\n    }\n  };\n\n  // Focus the text input on component mount\n  useEffect(() => {\n    var _textInputRef$current;\n    (_textInputRef$current = textInputRef.current) === null || _textInputRef$current === void 0 ? void 0 : _textInputRef$current.focus();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"message-input-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: `mic-button ${isRecording ? 'recording' : ''}`,\n      onClick: isRecording ? stopRecording : startRecording,\n      title: isRecording ? 'Dừng ghi âm' : 'Bắt đầu ghi âm',\n      children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: isRecording ? faStop : faMicrophone\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"message-form\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        ref: textInputRef,\n        className: \"message-input\",\n        value: message,\n        onChange: handleInputChange,\n        onKeyDown: handleKeyDown,\n        placeholder: \"Nh\\u1EADp c\\xE2u h\\u1ECFi v\\u1EC1 \\u0110\\u1EA3o Tr\\u01B0\\u1EDDng Sa...\",\n        disabled: isRecording\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"send-button\",\n        disabled: !message.trim() || isRecording,\n        children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n          icon: faPaperPlane\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n};\n_s(MessageInput, \"cypttcCJE4a+wgt4xzzVk5vEXSY=\");\n_c = MessageInput;\nexport default MessageInput;\nvar _c;\n$RefreshReg$(_c, \"MessageInput\");","map":{"version":3,"names":["React","useState","useEffect","useRef","FontAwesomeIcon","faPaperPlane","faMicrophone","faStop","jsxDEV","_jsxDEV","MessageInput","onSendMessage","_s","message","setMessage","isRecording","setIsRecording","audioBlob","setAudioBlob","mediaRecorderRef","audioChunksRef","textInputRef","handleInputChange","e","target","value","handleSubmit","preventDefault","trim","startRecording","stream","navigator","mediaDevices","getUserMedia","audio","current","MediaRecorder","ondataavailable","event","data","size","push","onstop","Blob","type","reader","FileReader","readAsDataURL","onloadend","base64Audio","result","split","getTracks","forEach","track","stop","start","error","console","alert","stopRecording","handleKeyDown","key","shiftKey","_textInputRef$current","focus","className","children","onClick","title","icon","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","ref","onChange","onKeyDown","placeholder","disabled","_c","$RefreshReg$"],"sources":["/home/phamvanhung/Product_test/Chatbot_GL2_version1/FlaskAIChatbot/frontend/src/components/MessageInput.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faPaperPlane, faMicrophone, faStop } from '@fortawesome/free-solid-svg-icons';\n\nconst MessageInput = ({ onSendMessage }) => {\n  const [message, setMessage] = useState('');\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioBlob, setAudioBlob] = useState(null);\n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n  const textInputRef = useRef(null);\n\n  const handleInputChange = (e) => {\n    setMessage(e.target.value);\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (message.trim()) {\n      onSendMessage(message);\n      setMessage('');\n    }\n  };\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      mediaRecorderRef.current = new MediaRecorder(stream);\n      \n      mediaRecorderRef.current.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n        }\n      };\n      \n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });\n        setAudioBlob(audioBlob);\n        audioChunksRef.current = [];\n        \n        // Send audio to backend\n        const reader = new FileReader();\n        reader.readAsDataURL(audioBlob);\n        reader.onloadend = () => {\n          const base64Audio = reader.result.split(',')[1];\n          onSendMessage(base64Audio, true);\n        };\n        \n        // Stop all tracks of the stream\n        stream.getTracks().forEach(track => track.stop());\n      };\n      \n      audioChunksRef.current = [];\n      mediaRecorderRef.current.start();\n      setIsRecording(true);\n    } catch (error) {\n      console.error('Error accessing microphone:', error);\n      alert('Không thể truy cập microphone. Vui lòng kiểm tra quyền truy cập.');\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const handleKeyDown = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e);\n    }\n  };\n\n  // Focus the text input on component mount\n  useEffect(() => {\n    textInputRef.current?.focus();\n  }, []);\n\n  return (\n    <div className=\"message-input-container\">\n      <button\n        className={`mic-button ${isRecording ? 'recording' : ''}`}\n        onClick={isRecording ? stopRecording : startRecording}\n        title={isRecording ? 'Dừng ghi âm' : 'Bắt đầu ghi âm'}\n      >\n        <FontAwesomeIcon icon={isRecording ? faStop : faMicrophone} />\n      </button>\n      \n      <form onSubmit={handleSubmit} className=\"message-form\">\n        <input\n          type=\"text\"\n          ref={textInputRef}\n          className=\"message-input\"\n          value={message}\n          onChange={handleInputChange}\n          onKeyDown={handleKeyDown}\n          placeholder=\"Nhập câu hỏi về Đảo Trường Sa...\"\n          disabled={isRecording}\n        />\n        <button \n          type=\"submit\" \n          className=\"send-button\" \n          disabled={!message.trim() || isRecording}\n        >\n          <FontAwesomeIcon icon={faPaperPlane} />\n        </button>\n      </form>\n    </div>\n  );\n};\n\nexport default MessageInput;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}